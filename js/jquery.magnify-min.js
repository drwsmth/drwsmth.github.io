!function($){$.fn.magnify=function(t){t=$.extend({src:"",speed:100,timeout:-1,touchBottomOffset:0,finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null,limitBounds:!1,mobileCloseEvent:"touchstart",afterLoad:function(){}},t);var i=this,e=$("html"),n=function(i){var n=$(i),a=n.closest("a"),s={};for(var r in t)s[r]=n.attr("data-magnify-"+r.toLowerCase());var f=s.src||t.src||a.attr("href")||"";if(f){var l,d,u,c,h,g,m,p,v=0,y=0,b,w,N=function(){var t=l.offset();return w={top:n.offset().top-t.top+parseInt(n.css("border-top-width"))+parseInt(n.css("padding-top")),left:n.offset().left-t.left+parseInt(n.css("border-left-width"))+parseInt(n.css("padding-left"))},t.top+=w.top,t.left+=w.left,t},P=function(){d.is(":visible")&&d.fadeOut(t.speed,function(){e.removeClass("magnifying").trigger("magnifyend")})},X=function(i){if(!c)return void o();if(i?(i.preventDefault(),nPosX=i.pageX||i.originalEvent.touches[0].pageX,nPosY=i.pageY||i.originalEvent.touches[0].pageY,n.data("lastPos",{x:nPosX,y:nPosY})):(nPosX=n.data("lastPos").x,nPosY=n.data("lastPos").y),nX=nPosX-b.left,nY=nPosY-b.top-t.touchBottomOffset,d.is(":animated")||(nX>v&&nX<u-v&&nY>y&&nY<c-y?d.is(":hidden")&&(e.addClass("magnifying").trigger("magnifystart"),d.fadeIn(t.speed)):P()),d.is(":visible")){var a="";if(h&&g){var s=-Math.round(nX/u*h-m/2),r=-Math.round(nY/c*g-p/2);if(t.limitBounds){var f=-Math.round((u-v)/u*h-m/2),l=-Math.round((c-y)/c*g-p/2);s>0?s=0:s<f&&(s=f),r>0?r=0:r<l&&(r=l)}a=s+"px "+r+"px"}d.css({top:Math.round(nY-p/2)+w.top+"px",left:Math.round(nX-m/2)+w.left+"px","background-position":a})}};isNaN(+s.speed)||(t.speed=+s.speed),isNaN(+s.timeout)||(t.timeout=+s.timeout),isNaN(+s.finalWidth)||(t.finalWidth=+s.finalWidth),isNaN(+s.finalHeight)||(t.finalHeight=+s.finalHeight),isNaN(+s.magnifiedWidth)||(t.magnifiedWidth=+s.magnifiedWidth),isNaN(+s.magnifiedHeight)||(t.magnifiedHeight=+s.magnifiedHeight),"true"===s.limitBounds&&(t.limitBounds=!0),"function"==typeof window[s.afterLoad]&&(t.afterLoad=window[s.afterLoad]),/\b(Android|BlackBerry|IEMobile|iPad|iPhone|Mobile|Opera Mini)\b/.test(navigator.userAgent)?isNaN(+s.touchBottomOffset)||(t.touchBottomOffset=+s.touchBottomOffset):t.touchBottomOffset=0,n.data("originalStyle",n.attr("style"));var Y=new Image;$(Y).on({load:function(){var i,e,o,r;n.css("display","block"),n.parent(".magnify").length||n.wrap('<div class="magnify"></div>'),l=n.parent(".magnify"),n.prev(".magnify-lens").length?l.children(".magnify-lens").css("background-image","url('"+f+"')"):n.before('<div class="magnify-lens loading" style="background:url(\''+f+"') 0 0 no-repeat\"></div>"),d=l.children(".magnify-lens"),d.removeClass("loading"),u=t.finalWidth||n.width(),c=t.finalHeight||n.height(),h=t.magnifiedWidth||Y.width,g=t.magnifiedHeight||Y.height,m=d.width(),p=d.height(),b=N(),t.limitBounds&&(v=m/2/(h/u),y=p/2/(g/c)),h===Y.width&&g===Y.height||d.css("background-size",h+"px "+g+"px"),n.data("zoomSize",{width:h,height:g}),l.data("mobileCloseEvent",s.mobileCloseEvent||t.mobileCloseEvent),Y=null,t.afterLoad(),d.is(":visible")&&X(),l.off().on({"mousemove touchmove":X,mouseenter:function(){b=N()},mouseleave:P}),t.timeout>=0&&l.on("touchend",function(){setTimeout(P,t.timeout)}),$("body").not(l).on("touchstart",P);var w=n.attr("usemap");if(w){var B=$("map[name="+w.slice(1)+"]");n.after(B),l.click(function(t){if(t.clientX||t.clientY){d.hide();var i=document.elementFromPoint(t.clientX||t.originalEvent.touches[0].clientX,t.clientY||t.originalEvent.touches[0].clientY);"AREA"===i.nodeName?i.click():$("area",B).each(function(){var t=$(this).attr("coords").split(",");if(o>=t[0]&&o<=t[2]&&r>=t[1]&&r<=t[3])return this.click(),!1})}})}a.length&&(a.css("display","inline-block"),!a.attr("href")||s.src||t.src||a.click(function(t){t.preventDefault()}))},error:function(){Y=null}}),Y.src=f}},a=0,o=function(){clearTimeout(a),a=setTimeout(function(){i.destroy(),i.magnify(t)},100)};return this.destroy=function(){return this.each(function(){var t=$(this),i=t.prev("div.magnify-lens"),e=t.data("originalStyle");t.parent("div.magnify").length&&i.length&&(e?t.attr("style",e):t.removeAttr("style"),t.unwrap(),i.remove())}),$(window).off("resize",o),i},$(window).resize(o),this.each(function(){n(this)})}}(jQuery);